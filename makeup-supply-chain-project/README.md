## Dataset
In this project, we are working with a [dataset](https://www.kaggle.com/code/amirmotefaker/supply-chain-analysis/input) from a beauty and makeup supplier.
The dataset was publicly available but contained unrealistic values, so I refined and adjusted the data to better reflect plausible industry scenarios before applying it in my optimization models.
The refined dataset is available [here](https://github.com/sfzgzs/gurobi-notes/blob/main/makeup-supply-chain-project/code/cleaned_supply_chain_data.csv).
(The code used for refining the database is included in the project)
### Terms used (fields in the database)
The primary key in the table provided is SKU (Stock Keeping Unit). For each product the store carries, the following fields are given:
| Term | Description |
| ------------ | ---------------------------------------------------- |
| productType | Could be **skincare**, **haircare** or **cosmetics** |  
| SKU | Stock Keeping Unit, unique identifier for each product |
| price | - |
| Availability | ? |
| Number of products sold | Historical sales volume (Over how long?) |
| Revenue Generated | Also referred to as **sales** or **turnover**, the amount of income generated by the sale of goods. Different that **profit**.  Profits or **net** income generally imply total revenue minus total expenses in a given period. |
| Customer Demographic | Target customer group, could be **female**, **male**, **non-binary** or **unknown** |
| Stock levels | Current stock available (How is it different than availability?) |
| Lead time | Time between placement of an order, until it's ready for delivery (in Days) |
| Order Quantities | The number of products that get shipped together as a package. |
| Shipping Times | The time it takes for the item to be transported to the customer(in this scenario, the makeup store) after it's been produced and shipped | 
| Shipping Carriers | a company that physically transports goods or freight from one location to another, either by land, sea, or air. Options here are **Carrier A**, **Carrier B**, and **Carrier C** |
| Shipping Cost | The cost of moving one item of the product from the manufacturer to the makeup store |
| Supplier Name | we have **Supplier 1** through **Supplier 5** |
| Supplier Location | Cities: **Mumbai, Kolkata, Delhi, Bangalore, Chennai** |
| Production Volume | ? |
| Manufacturing lead time | Time from sales order created to production finished (ready for delivery) (I presume in this scenario, since the products are all transported to the store, it's the time the supplier takes after the sales order is created in their system?...) |
| Manufacturing costs | Same as above(Cost per unit charged by the supplier to the makeup store)? I'm assuming it's how much costs for the makeup store the buys this product from a supplier? |
| Inspection results | I'm assuming this is about the specific supplier's products? |
| Defect rates | Same as above? |
| Transportation modes | one of **Air, Road, Sea, and Rail** |
| Routes | Options **Route A, Route B, or Route C** |


### Data cleaning and Adjustments 
- For the fields **price**, **revenue generated**,**shipping cost**, and **manufacturing cost**, the data is supposed to be in some currency.
  It’s unusual for product prices to have more than 2 decimal places since pricing reflects currency.
    - This issue is fixed by limiting these numbers to two 2 decimal places.
- The value of the **manufacturing cost** should normally not be less than the **price**.
  In fact, in most cases, the (selling) **price** should be more than **manufacturing cost**+**shipping cost** for the business to gain any profit at all.
  It is also common sense that Shipping Cost should be $\leq$ 25% of Selling Price.
    - This is fixed by recalculating the Price (in rows in the dataset that do not make sense) as
      $(Manufacturing Cost+Shipping Cost)×(1+Markup Percentage)$
      where the typical **markup percentage** for mass-market beauty products is a ratio between [1,3].
- The field **revenue generated** is not equal to **price**$\times$**number of products sold**. This can easily be fixed.
- Excessively high **defect rates** are reported. Typical industry defect rates are <1%. Easy fix.
- **Manufacturing lead times** range from 1 to 30 days, with no correlation to the supplier. This is assumed to reflect the supplier’s internal production time.
- In realistic supply chain timelines, **manufacturing lead time for cosmetics** is typically between 3–15 days and **shipping lead time** is 2–7 days for domestic shipments, and 7–30 days for international shipments.
  - Could be fixed using ranged random generation.
- There are two fields with "lead time" header...
  - Removed one.
- Some rows have **Pass** as **inspection result** with high Defect Rates. Normally, if Defect Rate > threshold, the inspection would fail.
  - Fixed it to if Defect Rate > 2%, force Inspection Result = "Fail".
- **Transportation modes** and **shipping times** mismatch. Some products shipped by **Air** have long lead times (e.g., 30 days) even though **Air** is usually used for fast delivery.
  - Fix for **Air** shipments: **Lead Time** $\leq$ 7 days and **sea shipments**: **Lead Time** $\geq$ 15 days.
---
## Problem 1 Statement
In this dataset, we have one carrier(out of A, B, and C) selected for each product. 
Now, let us consider a situation where **all carriers offer identical services** for each SKU (exact same routes, modes, and lead times), but with **different shipping costs** (randomly added or subtracted 0.5 of the base cost).  

Now, the reason the store would not immediately choose the carrier with the minimum cost of shipping for each product is that bulk discounts apply when total shipped packages exceed a certain threshold for each carrier:
- **Carrier A**: 25% off beyond **100 packages**
- **Carrier B**: 30% off beyond **150 packages**
- **Carrier C**: 20% off beyond **50 packages**

Our goal is to assign carriers to each SKU **to minimize total cost**, considering both:
- The **shipping cost** (with discounts applied when thresholds are met)  
- The **manufacturing cost** of the products
  
---
## Optimization Model  

We model this problem as a **Mixed-Integer Quadratic Program (MIQP)** using **Gurobi**, with the following key elements:

- **Decision Variables**:  
  `xA[i], xB[i], xC[i]` -- Number of packages of SKU *i* shipped by Carriers A, B, C (integer)  

- **Constraints**:  
  - **Fulfillment**: The sum of packages ordered across all carriers must cover demand.  
    for each SKU: total number of packages shipped to store $\geq$ (number of products sold - stock levels) / order quantities 

  - **Discount Activation**: Implemented via **indicator constraints** (using Gurobi's `addGenConstrIndicator`):  
    e.g., *if total packages of Carrier A ≥ 100 → activate discount *  

- **Objective**:  
  Minimize:  Total Shipping Cost (after applying discounts at the carrier level) + Total Manufacturing Cost
(Holding and ordering costs are not considered in Problem 1.)
---
## Problem 2 Statement
Let us consider a more realistic scenario where two more factors are considered in calculating the number of products ordered in total:
1. Inventory Holding Cost (per unit per year)
   This typically reflects:
      - Storage cost,
      - Insurance, and
      - Depreciation/Obsolescence
    A practical rule of thumb is to consider 20% to 30% of the product ``acquisition''(manufacturing+shipping) cost per year.
In our model, we randomly assign a holding cost percentage within this range to each SKU.
2. Ordering Cost (per order)
   may include:
     - Administrative costs (time spent by staff placing the order)
     - Order processing fees (paperwork, invoicing, system use)
     - Shipping/freight fees (flat fees, if applicable)
     - Customs/brokerage fees (for international orders)
     - Setup costs at the warehouse or store (handling incoming stock, inspection)
   This could be a flat dollar amount per order (no matter how many items in the order). In our code, we consider it to be a flat amount randomly selected between $30-$50 for each **supplier**.
- Additionally, if an order is split across multiple carriers, we add a flat split shipment penalty (ORDERING_COST_FOR_MORE_THAN_ONE_SHIPPING) per SKU.
  This is modeled via binary variables activated when more than one carrier is used for the same SKU.

## Optimization Model (Problem 2)
We extend the MIQP formulation used in Problem 1 with additional decision variables and constraints to capture inventory holding costs, ordering costs, and carrier split penalties.

- **Decision Variables**:  
  - `xA[i], xB[i], xC[i]` — Number of packages of SKU *i* shipped by Carriers A, B, C (integer)  
  - `usedA[i], usedB[i], usedC[i]` — Binary variables indicating if Carrier A, B, or C is used for SKU *i*  
  - `carrierCount[i]` — Integer variable counting the number of carriers used for SKU *i*  
  - `splitPenaltyActive[i]` — Binary variable that activates if SKU *i* is shipped with more than one carrier  

- **Additional Constraints**:  
  - **Carrier Usage Indicators**:  
    If `xA[i] > 0` then `usedA[i] = 1` (similarly for B and C)  
  - **Carrier Count Enforcement**:  
    `carrierCount[i] = usedA[i] + usedB[i] + usedC[i]`  
  - **Split Shipment Penalty Activation**:  
    `splitPenaltyActive[i] = 1` if `carrierCount[i] ≥ 2`  

- **Objective Function**:  
  Minimize:  
  - Total Manufacturing Cost  
    - Total Shipping Cost (with carrier discounts applied as in Problem 1)  
    -  Total Inventory Holding Cost  
    - Total Ordering Cost (flat per order per supplier)  
    -  Total Split Shipment Penalty  

- **Holding Cost Calculation**:  
  Holding Cost per SKU = (Manufacturing Cost + Shipping Cost) × Holding Cost Percentage × Total Units Ordered  

- **Ordering Cost**:  
  Flat cost per order per supplier + Split shipment penalty if applicable  
